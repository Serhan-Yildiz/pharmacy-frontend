<!DOCTYPE html>
<html>
<head>
    <title>Giriş Yap</title>
    <link rel="stylesheet" href="styles.css">
    <script defer>
        async function submitLogin(event) {
            event.preventDefault();
    
            const tc = document.getElementById("tc-login").value.trim();
            const name = document.getElementById("first-name").value.trim();
            const surname = document.getElementById("last-name").value.trim();
    
            try {
                const response = await fetch("https://pharmacy-backend-yeso.onrender.com/login", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ tc, name, surname })
                });
    
                const result = await response.json();
    
                if (response.ok) {
                    alert("Giriş başarılı!");
                    localStorage.setItem("patient", JSON.stringify(result.patient));
                    window.location.href = "profile.html";
                } else {
                    alert(result.error || "Giriş başarısız");
                }
            } catch (error) {
                console.error("Giriş hatası:", error);
                alert("Sunucuya bağlanılamadı.");
            }
        }
    </script>    
</head>
<body>
    <div id="login-form">
        <h2>Giriş Yap</h2>
        <form id="login" onsubmit="submitLogin(event)">
            <div>
                <label for="tc-login">TC Kimlik No:</label><br>
                <input type="text" id="tc-login" name="tc" required maxlength="11" pattern="[0-9]{11}" title="11 haneli TC Kimlik numarası girin">
            </div>
            <div style="display: flex">
                <div>
                    <label for="first-name">Ad:</label><br>
                    <input type="text" id="first-name" name="first-name" required>
                </div>
                <div>
                    <label for="last-name">Soyad:</label><br>
                    <input type="text" id="last-name" name="last-name" required>
                </div>
            </div>
            <button type="submit">Giriş Yap</button>
            <button type="button" onclick="window.location.href = 'index.html'">Ana Sayfaya Dön</button>
        </form>
    </div>
</body>
</html>